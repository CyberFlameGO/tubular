default-flavor: stretch

stretch: &stretch
  build: &build-stretch
    builddeps:
      - build-essential
      - crossbuild-essential-arm64
      - rubygem-fpm
      - clang-9
      - go
    post-cache:
      - CC=x86_64-linux-gnu-gcc ARCH=amd64 make package
      - CC=aarch64-linux-gnu-gcc ARCH=arm64 make package
      - git diff-files --quiet || { echo "unstaged changes present" >&2; false; }
  test:
    <<: *build-stretch
    post-cache:
      - CC=x86_64-linux-gnu-gcc ARCH=amd64 make all test
      - git diff-files --quiet || { echo "unstaged changes present" >&2; false; }

buster:
  <<: *stretch
